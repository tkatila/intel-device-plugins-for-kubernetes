name: Update demo bases
on:
  schedule:
    - cron: '0 0 1 * *' # once a month
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  demo_base_update:
    name: Create a PR for demo image updates
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29 # v4
      - name: Install frizbee
        run: |
          mkdir bin && wget -q https://github.com/stacklok/frizbee/releases/download/v0.0.15/frizbee_0.0.15_linux_amd64.tar.gz -O - | tar xz -C bin
          chmod +x bin/frizbee
      - name: Run update script
        run: |
          export PATH=$PATH:$(pwd)/bin
          cd demo
          bash update-shas.sh

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "demo: update base images"
          title: 'Update demo base images'
          token: ${{ secrets.GH_PR_TOKEN }}
          body: >
            PR is auto-generated by GH action.

