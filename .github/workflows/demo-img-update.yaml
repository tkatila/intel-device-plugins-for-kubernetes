name: Update demo bases
on:
  schedule:
    - cron: '0 0 1 * *' # once a month
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  demo_base_update:
    name: Create a PR for demo image updates
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29 # v4
      - name: Install frizbee
        run: |
          export FRIZBEE_HASH=cda91f86d0c96d0bc3c464c57a601ca414e0b2415372eb19b9a4c82fa3d4f802
          export FRIZBEE_VERSION=0.0.15

          mkdir /tmp/frizbee
          wget -q https://github.com/stacklok/frizbee/releases/download/v${FRIZBEE_VERSION}/frizbee_${FRIZBEE_VERSION}_linux_amd64.tar.gz -O /tmp/frizbee/frizbee.tar.gz
          cd /tmp/frizbee
          echo "$FRIZBEE_HASH frizbee.tar.gz" | sha256sum -c -
          tar xzf frizbee.tar.gz
          chmod +x /tmp/frizbee/frizbee
      - name: Run update script
        run: |
          export PATH=$PATH:/tmp/frizbee
          cd demo
          bash update-shas.sh
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@4e1beaa7521e8b457b572c090b25bd3db56bf1c5 # v5
        with:
          commit-message: "demo: update base images"
          title: 'Update demo base images'
          token: ${{ secrets.GH_PR_TOKEN }}
          body: >
            PR is auto-generated by GH action.



